# 多行选择和右键菜单功能说明

## 功能概述

实现了文件显示区的多行选择功能和右键菜单，支持复制已选数据和位置信息。

## 功能特性

### 1. 多行选择

#### 选择方式
- **单击选择**：点击一行进行选择
- **Shift+点击**：选择一个范围内的多行
- **Ctrl+点击**：添加或移除单行选择

#### 同步选择
- 文件A和文件B的选择会自动同步
- 在任一文件中选择行，另一文件会自动选中相同的行

### 2. 右键菜单

右键点击已选行时，会显示以下菜单选项：

#### 复制已选数据
- **功能**：复制所有已选行的十六进制数据
- **格式**：每行一个，字节之间用空格分隔
- **示例**：
  ```
  00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
  10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F
  ```

#### 复制位置信息
- **功能**：复制已选行的位置信息和数据
- **格式**：起始地址-结束地址:数据
- **示例**：
  ```
  0000-000F:00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
  0010-001F:10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F
  ```

## 使用步骤

### 步骤 1：加载文件
1. 点击"选择文件A"和"选择文件B"加载两个二进制文件
2. 或拖拽文件到对应的显示区域

### 步骤 2：选择数据行
1. **单行选择**：点击任意行
2. **多行选择**：
   - 按住 Shift 并点击另一行，选择范围内的所有行
   - 按住 Ctrl 并点击，添加或移除单行选择

### 步骤 3：右键菜单
1. 右键点击已选行
2. 选择菜单选项：
   - "复制已选数据" - 复制十六进制数据
   - "复制位置信息" - 复制位置和数据

### 步骤 4：粘贴数据
1. 使用 Ctrl+V 或右键菜单粘贴到其他应用
2. 数据已复制到系统剪贴板

## 技术实现

### XAML 修改
- 将 `ListBox` 的 `SelectionMode` 改为 `Multiple`
- 添加 `ContextMenu` 右键菜单
- 添加 `KeyDown` 和 `MouseRightButtonUp` 事件处理

### 代码实现

#### 事件处理
- `ListBoxFileA_KeyDown` / `ListBoxFileB_KeyDown` - 键盘事件处理
- `ListBoxFileA_MouseRightButtonUp` / `ListBoxFileB_MouseRightButtonUp` - 右键点击事件
- `MenuItemCopyData_Click` / `MenuItemCopyDataB_Click` - 复制数据
- `MenuItemCopyLocation_Click` / `MenuItemCopyLocationB_Click` - 复制位置信息

#### 选择同步
- `ListBoxFileA_SelectionChanged` - 文件A选择变更时同步文件B
- `ListBoxFileB_SelectionChanged` - 文件B选择变更时同步文件A

### 数据格式

#### 十六进制数据格式
```
每行一个，字节之间用空格分隔
示例：00 01 02 03 04 05 06 07
```

#### 位置信息格式
```
起始地址-结束地址:数据
示例：0000-0007:00 01 02 03 04 05 06 07
```

地址使用 4 位十六进制表示（大写）

## 功能特点

### ✅ 优势
- 支持多行选择，提高工作效率
- 自动同步两个文件的选择
- 右键菜单操作简单直观
- 支持两种复制格式
- 数据格式清晰易读

### 📋 使用场景
- 批量复制数据进行分析
- 记录特定地址范围的数据
- 导出数据到其他工具
- 对比不同文件的特定区域

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| 单击 | 选择单行 |
| Shift+点击 | 选择范围 |
| Ctrl+点击 | 添加/移除选择 |
| 右键 | 显示菜单 |
| Ctrl+V | 粘贴数据 |

## 状态提示

操作完成后，状态栏会显示相应的提示信息：

- "已复制 N 行数据到剪贴板" - 复制数据成功
- "已复制 N 行位置信息到剪贴板" - 复制位置信息成功
- "请先选择数据行" - 未选择任何行
- "复制数据失败: xxx" - 复制出错

## 编译状态

- **编译结果**：✅ 成功
- **错误数**：0
- **警告数**：36（都是 null 性相关的警告）

## 相关文件

### 修改的文件
- `MainWindow.xaml` - 添加多选支持和右键菜单
- `MainWindow.xaml.cs` - 实现事件处理和数据复制逻辑

### 新增功能
- 多行选择（Shift+点击、Ctrl+点击）
- 右键菜单（复制数据、复制位置信息）
- 选择同步（文件A和文件B自动同步）

## 测试清单

- [ ] 单行选择正常工作
- [ ] Shift+点击选择范围正常工作
- [ ] Ctrl+点击添加/移除选择正常工作
- [ ] 文件A和文件B的选择自动同步
- [ ] 右键菜单显示正确
- [ ] 复制已选数据格式正确
- [ ] 复制位置信息格式正确
- [ ] 粘贴到其他应用正常工作
- [ ] 状态提示信息正确

## 未来改进

- [ ] 支持按地址范围选择
- [ ] 支持按差异类型筛选选择
- [ ] 支持导出为文件
- [ ] 支持自定义复制格式
- [ ] 支持撤销/重做选择

---

**版本**：v1.6.2  
**功能类型**：UI 交互增强  
**状态**：✅ 已实现

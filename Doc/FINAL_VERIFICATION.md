# 最终验证指南

## 功能完整性检查

### ✅ 已实现的功能

#### 1. 字节级差异高亮
- [x] 单字节差异显示（浅红色）
- [x] 点击差异列表时临时高亮（黄色）
- [x] 2秒后自动取消高亮
- [x] 支持十六进制和二进制模式

#### 2. 拖拽文件加载
- [x] 拖拽单个文件到程序图标
- [x] 拖拽两个文件到程序图标
- [x] 命令行参数支持
- [x] 自动对比功能
- [x] 文件关联配置

#### 3. 文件关联
- [x] PowerShell 注册脚本
- [x] 批处理注册脚本
- [x] 注册表文件
- [x] 右键菜单"用 BinCompare 打开"
- [x] 双击文件直接打开

## 完整测试流程

### 测试环境准备

#### 1. 编译程序
```bash
cd i:\LucasCSharp\Lisson\App\BinCompare
dotnet build
```

#### 2. 安装程序
```bash
# 创建安装目录
mkdir "C:\Program Files\BinCompare"

# 复制程序文件
copy "bin\Debug\net8.0-windows\BinCompare.exe" "C:\Program Files\BinCompare\"
```

#### 3. 注册文件关联
选择以下任意一种方法：

**方法 A：PowerShell（推荐）**
```powershell
# 以管理员身份运行 PowerShell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
& "C:\path\to\RegisterFileAssociation.ps1"
```

**方法 B：批处理**
```bash
# 右键点击 RegisterFileAssociation.bat
# 选择 "以管理员身份运行"
```

**方法 C：注册表**
```bash
# 双击 RegisterFileAssociation.reg
# 点击 "是" 确认
```

### 测试用例

#### 测试 1：拖拽单个文件
**步骤**：
1. 找到 `TestFileA.bin` 或任意 `.bin` 文件
2. 拖拽到 BinCompare 程序图标
3. 等待程序启动

**预期结果**：
- ✅ 程序启动
- ✅ 文件加载到文件A
- ✅ 显示文件内容（十六进制或二进制）
- ✅ 状态栏显示 "文件A已加载: xxx (xxx 字节)"

**验证方式**：
```
检查项：
□ 程序成功启动
□ 文件A 显示正确的文件名
□ 文件A 显示正确的文件大小
□ 文件内容正确显示
□ 状态消息正确
```

---

#### 测试 2：拖拽两个文件
**步骤**：
1. 找到 `TestFileA.bin` 和 `TestFileB.bin`
2. 同时选中两个文件（Ctrl+点击）
3. 拖拽到 BinCompare 程序图标
4. 等待程序启动并进行对比

**预期结果**：
- ✅ 程序启动
- ✅ 文件A 和文件B 都加载
- ✅ 自动进行对比
- ✅ 显示差异信息
- ✅ 差异字节显示为浅红色

**验证方式**：
```
检查项：
□ 程序成功启动
□ 文件A 加载正确
□ 文件B 加载正确
□ 自动进行了对比
□ 差异信息显示
□ 差异字节高亮正确
```

---

#### 测试 3：点击差异列表进行高亮
**步骤**：
1. 完成测试 2（拖拽两个文件）
2. 在右侧"差异信息"列表中点击任意差异项
3. 观察左侧文件显示区

**预期结果**：
- ✅ 对应的差异字节变为黄色高亮
- ✅ 两个文件的对应字节都被高亮
- ✅ 2秒后自动取消黄色高亮
- ✅ 恢复为浅红色

**验证方式**：
```
检查项：
□ 差异字节高亮为黄色
□ 两个文件都高亮
□ 2秒后自动取消
□ 恢复为浅红色
```

---

#### 测试 4：右键菜单打开
**步骤**：
1. 右键点击任意 `.bin` 文件
2. 选择 "用 BinCompare 打开"
3. 等待程序启动

**预期结果**：
- ✅ 程序启动
- ✅ 文件加载到文件A
- ✅ 显示文件内容

**验证方式**：
```
检查项：
□ 右键菜单显示 "用 BinCompare 打开"
□ 程序成功启动
□ 文件加载正确
```

---

#### 测试 5：双击文件打开
**步骤**：
1. 双击任意 `.bin` 文件
2. 等待程序启动

**预期结果**：
- ✅ 程序启动
- ✅ 文件加载到文件A
- ✅ 显示文件内容

**验证方式**：
```
检查项：
□ 程序成功启动
□ 文件加载正确
□ 显示正确
```

---

#### 测试 6：命令行启动
**步骤**：
1. 打开命令提示符或 PowerShell
2. 执行命令：
   ```bash
   BinCompare.exe "C:\path\to\TestFileA.bin"
   ```
3. 等待程序启动

**预期结果**：
- ✅ 程序启动
- ✅ 文件加载到文件A

**验证方式**：
```
检查项：
□ 程序成功启动
□ 文件加载正确
```

---

#### 测试 7：命令行启动（双文件）
**步骤**：
1. 打开命令提示符或 PowerShell
2. 执行命令：
   ```bash
   BinCompare.exe "C:\path\to\TestFileA.bin" "C:\path\to\TestFileB.bin"
   ```
3. 等待程序启动并进行对比

**预期结果**：
- ✅ 程序启动
- ✅ 两个文件都加载
- ✅ 自动进行对比

**验证方式**：
```
检查项：
□ 程序成功启动
□ 文件A 加载正确
□ 文件B 加载正确
□ 自动对比
```

---

#### 测试 8：显示模式切换
**步骤**：
1. 加载文件
2. 点击 "十六进制" 或 "二进制" 按钮切换显示模式
3. 观察显示变化

**预期结果**：
- ✅ 显示模式正确切换
- ✅ 差异高亮保持
- ✅ 字节级高亮功能正常

**验证方式**：
```
检查项：
□ 显示模式切换成功
□ 内容正确显示
□ 高亮功能正常
```

---

#### 测试 9：每行字节数调整
**步骤**：
1. 加载文件
2. 从下拉菜单选择不同的每行字节数（8、16、32、64）
3. 观察显示变化

**预期结果**：
- ✅ 每行字节数正确改变
- ✅ 差异高亮保持
- ✅ 对比结果正确

**验证方式**：
```
检查项：
□ 每行字节数改变成功
□ 内容正确显示
□ 高亮功能正常
```

---

#### 测试 10：导出差异报告
**步骤**：
1. 加载两个文件并进行对比
2. 点击 "导出差异" 按钮
3. 选择保存位置

**预期结果**：
- ✅ 文件对话框打开
- ✅ 差异报告成功导出
- ✅ 文件内容正确

**验证方式**：
```
检查项：
□ 导出对话框打开
□ 文件成功保存
□ 文件内容正确
```

## 完整测试清单

```
基本功能测试：
□ 测试 1：拖拽单个文件
□ 测试 2：拖拽两个文件
□ 测试 3：点击差异列表高亮
□ 测试 4：右键菜单打开
□ 测试 5：双击文件打开
□ 测试 6：命令行启动（单文件）
□ 测试 7：命令行启动（双文件）

功能测试：
□ 测试 8：显示模式切换
□ 测试 9：每行字节数调整
□ 测试 10：导出差异报告

总体评估：
□ 所有测试通过
□ 功能正常
□ 性能满足要求
□ 用户体验良好
```

## 性能基准

| 操作 | 预期时间 | 实际时间 |
|------|---------|---------|
| 程序启动 | < 2 秒 | |
| 单文件加载 | < 1 秒 | |
| 双文件对比 | < 5 秒 | |
| 高亮切换 | < 100ms | |
| 显示模式切换 | < 500ms | |

## 问题排查

如果测试失败，请按以下步骤排查：

### 问题 1：程序无法启动
- [ ] 检查 `C:\Program Files\BinCompare\` 目录是否存在
- [ ] 检查 `BinCompare.exe` 是否存在
- [ ] 检查文件权限是否正确
- [ ] 尝试直接运行 `BinCompare.exe`

### 问题 2：文件无法加载
- [ ] 检查文件路径是否正确
- [ ] 检查文件是否存在
- [ ] 检查文件权限是否正确
- [ ] 查看状态栏的错误信息

### 问题 3：拖拽无法工作
- [ ] 检查文件关联是否注册
- [ ] 重新运行注册脚本
- [ ] 重启计算机
- [ ] 检查注册表配置

### 问题 4：高亮不显示
- [ ] 检查是否有差异
- [ ] 检查颜色设置是否正确
- [ ] 尝试切换显示模式
- [ ] 尝试调整每行字节数

## 完成标志

当以下条件都满足时，功能实现完成：

- ✅ 所有 10 个测试用例都通过
- ✅ 没有运行时错误
- ✅ 性能指标符合预期
- ✅ 用户体验良好
- ✅ 文档完整

---

**版本**：v1.6.0+  
**最后更新**：2025-11-22  
**状态**：✅ 准备就绪

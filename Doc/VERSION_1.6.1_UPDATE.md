# v1.6.1 版本更新总结

## 版本信息

- **版本号**：v1.6.1
- **发布日期**：2025-11-22
- **编译状态**：✅ 成功（0 错误，36 警告）
- **框架**：.NET 8.0 Windows
- **架构**：MVVM

## 本版本更新内容

### 🐛 bug 修复

#### 1. 修复应用启动冲突
**问题**：`App.xaml` 中同时配置了 `StartupUri` 和 `Startup` 事件，导致程序启动异常

**解决**：
- 移除 `StartupUri="MainWindow.xaml"` 属性
- 在 `Application_Startup` 事件中手动创建和显示主窗口

#### 2. 修复文件加载时机
**问题**：使用 `Loaded` 事件处理命令行参数时，`ViewModel` 可能还没有完全初始化

**解决**：
- 改用 `ContentRendered` 事件而不是 `Loaded` 事件
- 确保窗口和 `ViewModel` 都已完全初始化后再处理文件加载

#### 3. 完善文件关联配置
**改进**：
- 提供 PowerShell 脚本（自动检查权限和程序路径）
- 提供批处理脚本（简单易用）
- 提供注册表文件（直接导入）

### ✨ 新增功能

#### 拖拽文件到程序图标加载
- **单文件拖拽**：拖拽一个文件到程序图标，自动加载到文件A
- **双文件拖拽**：拖拽两个文件到程序图标，自动加载到文件A和文件B，自动进行对比
- **命令行启动**：支持通过命令行参数启动程序并加载文件

### 📚 文档更新

新增以下文档：
- `DRAG_DROP_FIX_SUMMARY.md` - 拖拽功能修复总结
- `FILE_LOADING_FIX.md` - 文件加载修复说明
- `FINAL_VERIFICATION.md` - 完整的测试和验证指南
- `QUICK_SETUP.md` - 快速设置指南
- `FILE_ASSOCIATION_SETUP.md` - 文件关联设置指南
- `DRAG_DROP_GUIDE.md` - 拖拽功能详细指南
- `COMMAND_LINE_REFERENCE.md` - 命令行参数参考
- `VERSION_1.6.1_UPDATE.md` - 本文件

更新以下文档：
- `CHANGELOG.md` - 添加 v1.6.1 更新记录
- `README.md` - 更新版本号到 v1.6.1
- `FEATURE_SUMMARY_v1.6.0.md` - 更新版本号到 v1.6.1

### 🔧 技术改进

| 改进项 | 详情 |
|--------|------|
| 应用启动流程 | 改进启动顺序，确保所有初始化完成后再处理命令行参数 |
| ViewModel 初始化 | 优化初始化时机，使用 `ContentRendered` 事件 |
| 错误处理 | 完善错误处理和用户提示 |
| 文件关联 | 提供三种注册方式，提高易用性 |

## 版本对比

### v1.5.3 vs v1.6.1

| 功能 | v1.5.3 | v1.6.0 | v1.6.1 |
|------|--------|--------|--------|
| 差异显示 | 整行变色 | 单字节高亮 | 单字节高亮 |
| 点击高亮 | ❌ | ✅ 黄色临时高亮 | ✅ 黄色临时高亮 |
| 拖拽加载 | ❌ | ❌ | ✅ 单文件和双文件 |
| 命令行启动 | ❌ | ❌ | ✅ 支持文件参数 |
| 文件关联 | ❌ | ❌ | ✅ 三种注册方式 |
| 自动对比 | 手动触发 | 自动触发（双文件） | 自动触发（双文件） |

## 修改的文件

### 代码修改（2 个文件）
1. `App.xaml` - 移除 `StartupUri`
2. `App.xaml.cs` - 改用 `ContentRendered` 事件

### 配置更新（1 个文件）
1. `BinCompare.csproj` - 版本号 1.6.0 → 1.6.1

### UI 更新（1 个文件）
1. `MainWindow.xaml` - 版本号 1.6.0 → 1.6.1

### 文档更新（3 个文件）
1. `README.md` - 版本号 1.6.0 → 1.6.1
2. `CHANGELOG.md` - 添加 v1.6.1 记录
3. `FEATURE_SUMMARY_v1.6.0.md` - 版本号 1.6.0 → 1.6.1

### 新增文档（8 个文件）
1. `DRAG_DROP_FIX_SUMMARY.md`
2. `FILE_LOADING_FIX.md`
3. `FINAL_VERIFICATION.md`
4. `QUICK_SETUP.md`
5. `FILE_ASSOCIATION_SETUP.md`
6. `DRAG_DROP_GUIDE.md`
7. `COMMAND_LINE_REFERENCE.md`
8. `VERSION_1.6.1_UPDATE.md`

## 编译状态

- **编译结果**：✅ 成功
- **错误数**：0
- **警告数**：36（都是 null 性相关的警告）
- **编译时间**：~1.6 秒

## 功能完整性检查

### ✅ 已实现的功能

#### 字节级差异高亮
- [x] 单字节差异显示（浅红色）
- [x] 点击差异列表时临时高亮（黄色）
- [x] 2秒后自动取消高亮
- [x] 支持十六进制和二进制模式

#### 拖拽文件加载
- [x] 拖拽单个文件到程序图标
- [x] 拖拽两个文件到程序图标
- [x] 命令行参数支持
- [x] 自动对比功能
- [x] 文件关联配置（三种方式）

#### 文件关联
- [x] PowerShell 注册脚本
- [x] 批处理注册脚本
- [x] 注册表文件
- [x] 右键菜单"用 BinCompare 打开"
- [x] 双击文件直接打开

## 使用指南

### 快速开始

1. **编译程序**
   ```bash
   dotnet build
   ```

2. **安装程序**
   ```
   将 BinCompare.exe 复制到 C:\Program Files\BinCompare\
   ```

3. **注册文件关联**
   - 运行 `RegisterFileAssociation.ps1`（推荐）
   - 或运行 `RegisterFileAssociation.bat`
   - 或导入 `RegisterFileAssociation.reg`

4. **使用**
   - 拖拽文件到程序图标
   - 右键点击文件选择"用 BinCompare 打开"
   - 双击文件直接打开
   - 通过命令行启动

### 支持的文件类型
- `.bin` - 二进制文件
- `.dat` - 数据文件
- `.hex` - 十六进制文件
- `.rom` - ROM 文件
- `.img` - 镜像文件

## 性能指标

| 操作 | 预期时间 |
|------|---------|
| 程序启动 | < 2 秒 |
| 单文件加载 | < 1 秒 |
| 双文件对比 | < 5 秒 |
| 高亮切换 | < 100ms |

## 向后兼容性

- ✅ 完全兼容 v1.6.0
- ✅ 完全兼容 v1.5.3
- ✅ 不影响现有功能
- ✅ 不需要用户更改任何设置

## 已知限制

1. **高亮时间固定**：目前固定为 2 秒，可在代码中修改
2. **高亮颜色固定**：目前使用黄色，可在转换器中修改
3. **文件数量限制**：拖拽多个文件时，只使用前两个
4. **内存限制**：文件大小受系统内存限制

## 未来计划

### v1.7.0 计划
- [ ] 支持自定义高亮时间
- [ ] 支持自定义高亮颜色
- [ ] 添加键盘快捷键快速导航
- [ ] 添加"上一个差异"和"下一个差异"按钮

### v2.0.0 计划（长期）
- [ ] 支持多选差异进行批量操作
- [ ] 支持拖拽文件夹
- [ ] 支持最近打开文件列表
- [ ] 支持文件关联
- [ ] 性能优化（支持超大文件）

## 测试清单

- [ ] 拖拽单个文件，文件加载到文件A
- [ ] 拖拽两个文件，文件分别加载到文件A和文件B
- [ ] 自动进行对比，显示差异
- [ ] 右键菜单"用 BinCompare 打开"正常工作
- [ ] 双击文件直接打开
- [ ] 命令行启动正常工作
- [ ] 字节级高亮功能正常
- [ ] 点击差异列表进行高亮

## 相关文档

- `CHANGELOG.md` - 完整的版本历史
- `README.md` - 项目主文档
- `QUICK_SETUP.md` - 快速设置指南
- `FINAL_VERIFICATION.md` - 完整的测试指南
- `FEATURE_SUMMARY_v1.6.0.md` - 功能总结

---

**版本**：v1.6.1  
**发布日期**：2025-11-22  
**状态**：✅ 已发布

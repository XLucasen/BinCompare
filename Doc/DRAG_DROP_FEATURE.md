# 拖拽文件功能说明

## 功能概述

用户现在可以直接拖拽二进制文件到文件A或文件B的显示区域来快速打开文件，无需通过按钮选择。

## 使用方法

### 打开文件A
1. 从文件管理器中选择一个.BIN文件
2. 拖拽该文件到左侧"文件A"显示区域
3. 文件会自动加载到文件A
4. 如果文件B已加载，会自动进行对比

### 打开文件B
1. 从文件管理器中选择一个.BIN文件
2. 拖拽该文件到右侧"文件B"显示区域
3. 文件会自动加载到文件B
4. 如果文件A已加载，会自动进行对比

## 视觉反馈

### 拖拽进入
- 当拖拽文件进入文件A区域时，边框变为蓝色（#0078D4）并加粗
- 当拖拽文件进入文件B区域时，边框变为绿色（#107C10）并加粗

### 拖拽离开
- 当拖拽文件离开区域时，边框恢复为灰色（#CCCCCC）

### 拖拽放下
- 文件成功加载后，状态栏显示"文件X已加载: filename.bin (size 字节)"
- 如果两个文件都已加载，自动进行对比并显示"对比完成: 发现 X 处差异"

## 技术实现

### XAML配置
```xml
<!-- 文件A显示区 -->
<Border Name="BorderFileA" AllowDrop="True" 
       DragEnter="BorderFileA_DragEnter" 
       DragLeave="BorderFileA_DragLeave"
       Drop="BorderFileA_Drop">
```

### 事件处理

#### DragEnter 事件
- 检查拖拽数据是否为文件
- 如果是文件，显示复制光标和高亮边框
- 如果不是文件，显示禁止光标

#### DragLeave 事件
- 恢复边框样式到正常状态

#### Drop 事件
- 获取拖拽的文件路径
- 读取文件内容
- 更新ViewModel中的文件数据
- 自动进行对比（如果两个文件都已加载）

## 支持的文件类型

- .BIN 文件（推荐）
- 任何二进制文件（.bin、.hex、.dat等）
- 所有文件类型（*.*）

## 错误处理

### 文件不存在
- 显示错误信息："加载文件X失败: 文件不存在"

### 文件被占用
- 显示错误信息："加载文件X失败: 文件被占用"

### 其他错误
- 显示错误信息："加载文件X失败: [具体错误信息]"

## 快捷操作

### 快速对比流程
1. 拖拽文件A到左侧区域
2. 拖拽文件B到右侧区域
3. 自动进行对比
4. 查看差异结果

### 替换文件
1. 拖拽新文件到相同区域
2. 旧文件被替换
3. 自动重新对比

## 与其他功能的配合

### 与按钮选择的区别
- **按钮选择**：打开文件对话框，用户可以浏览文件系统
- **拖拽文件**：直接从文件管理器拖拽，更快速便捷

### 与清除功能的配合
- 点击"清除"按钮后，可以重新拖拽文件
- 拖拽新文件时会自动清除旧数据

### 与显示模式的配合
- 拖拽加载文件后，使用当前的显示模式（十六进制/二进制）
- 可以在加载后切换显示模式

## 性能考虑

### 大文件处理
- 拖拽加载大文件时，UI可能会短暂卡顿
- 文件加载完成后会显示状态提示

### 内存占用
- 文件完全加载到内存
- 建议单个文件不超过500MB

## 常见问题

### Q: 拖拽不工作？
A: 确保：
1. 拖拽的是文件（不是文件夹）
2. 拖拽到的是显示区域（不是其他地方）
3. 文件不被其他程序占用

### Q: 能否拖拽多个文件？
A: 不能。只会加载拖拽的第一个文件。

### Q: 拖拽后为什么没有自动对比？
A: 自动对比需要两个文件都已加载。如果只加载了一个文件，需要加载第二个文件后才会自动对比。

### Q: 能否拖拽文件夹？
A: 不能。只支持拖拽文件。

## 改进建议

### 可能的未来增强
- [ ] 支持拖拽多个文件进行批量对比
- [ ] 支持拖拽文件夹中的所有文件
- [ ] 显示拖拽进度条
- [ ] 支持拖拽后的撤销操作

## 相关代码

### 主要类和方法
- `MainWindow.xaml.cs`
  - `BorderFileA_DragEnter()` - 文件A拖拽进入
  - `BorderFileA_DragLeave()` - 文件A拖拽离开
  - `BorderFileA_Drop()` - 文件A拖拽放下
  - `BorderFileB_DragEnter()` - 文件B拖拽进入
  - `BorderFileB_DragLeave()` - 文件B拖拽离开
  - `BorderFileB_Drop()` - 文件B拖拽放下
  - `LoadFileA()` - 加载文件A
  - `LoadFileB()` - 加载文件B

### 关键代码片段

#### 检查文件类型
```csharp
if (e.Data.GetDataPresent(DataFormats.FileDrop))
{
    e.Effects = DragDropEffects.Copy;
}
```

#### 获取文件路径
```csharp
string[] files = (string[])e.Data.GetData(DataFormats.FileDrop);
if (files != null && files.Length > 0)
{
    string filePath = files[0];
}
```

#### 自动对比
```csharp
if (_viewModel.FileA.Data.Length > 0 && _viewModel.FileB.Data.Length > 0)
{
    _viewModel.PerformComparison();
}
```

## 总结

拖拽文件功能提供了一种快速、直观的方式来加载二进制文件。结合现有的按钮选择功能，用户可以根据需要选择最便捷的操作方式。
